(this["webpackJsonpreact-jwt-auth"]=this["webpackJsonpreact-jwt-auth"]||[]).push([[0],{159:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(55),o=a.n(r),c=a(19),l=a(6),i=a(7),u=a(15),m=a(14),h=a(13),d=a(2),g=(a(68),a(69),a(5)),p=a.n(g),f=(new(a(62).a),Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_LOGGED_IN_URL:"http://143.110.182.130:8081/profile",REACT_APP_LOGIN_HOME_URL:"http://143.110.182.130:8081/home",REACT_APP_LOGIN_REGISTER_URL:"http://143.110.182.130:8081/register"}).LOGIN_HOME_URL),v="http://localhost:8080/api/auth/",E=new(function(){function e(){Object(l.a)(this,e),this.authenticated=!1}return Object(i.a)(e,[{key:"isAuthenticated",value:function(){var e=localStorage.getItem("accessTokenExp");console.log("act11:::::::::"+e);var t=localStorage.getItem("refreshTokenExp"),a=localStorage.getItem("refreshToken");return e<(new Date).getTime()&&t<(new Date).getTime()?(console.log("Falils"),!1):e>(new Date).getTime()&&t>(new Date).getTime()?(console.log("Pass"),!0):void(e<(new Date).getTime()&&t>(new Date).getTime()&&p.a.post("/user-authenticate-service/get-refresh-token",{withCredentials:!0,refreshToken:a}).then((function(e){return console.log("GetRefresh: "+e.data),e.data.success?(console.log("ACS succcess"+e.data.accessToken),localStorage.setItem("accessToken",e.data.accessToken),localStorage.setItem("accessTokenExp",e.data.accessTokenExp),console.log("end Success"),window.location.reload(),!0):(window.location.replace(f),console.log("getRefresh false"+e.data),!1)}),(function(e){return window.location.replace(f),console.log("getRefresh false"+e.response),!1})).catch((function(e){return window.location.replace(f),console.log(e.response),!1})))}},{key:"login",value:function(e,t){return p.a.post(v+"signin",{username:e,password:t}).then((function(e){return e.data.accessToken&&localStorage.setItem("user",JSON.stringify(e.data)),e.data}))}},{key:"logout",value:function(){localStorage.removeItem("accessToken"),localStorage.removeItem("accessTokenExp"),localStorage.removeItem("refreshToken"),localStorage.removeItem("refreshTokenExp")}},{key:"register",value:function(e,t,a){return p.a.post(v+"signup",{username:e,email:t,password:a})}},{key:"getCurrentUser",value:function(){return console.log("cirrent user"),JSON.parse(localStorage.getItem("user"))}}]),e}()),b=a(56),k=a.n(b),_=a(29),O=a.n(_),N=a(57),S=a.n(N),w=a(58),T=new(function(){function e(){Object(l.a)(this,e)}return Object(i.a)(e,[{key:"authHeader",value:function(){var e=localStorage.getItem("accessToken"),t=localStorage.getItem("accessTokenExp");console.log("act:::::::::"+t);var a=localStorage.getItem("refreshToken");console.log("Ref"+a);localStorage.getItem("refreshTokenExp");return t>(new Date).getTime()?e:(p.a.post("/user-authenticate-service/get-refresh-token",{withCredentials:!0,refreshToken:a}).then((function(e){return console.log(e.data),localStorage.setItem("accessToken",e.data.accessToken),localStorage.setItem("accessTokenExp",e.data.accessTokenExp),window.location.reload(),console.log("end in auth e=headerS"),e.data.accessToken})).catch((function(e){console.log(e.response),window.location.replace(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_LOGGED_IN_URL:"http://143.110.182.130:8081/profile",REACT_APP_LOGIN_HOME_URL:"http://143.110.182.130:8081/home",REACT_APP_LOGIN_REGISTER_URL:"http://143.110.182.130:8081/register"}).LOGIN_HOME_URL)})),"")}}]),e}()),y=new(function(){function e(){Object(l.a)(this,e)}return Object(i.a)(e,[{key:"getDashboardHome",value:function(){return console.log("Dashboard Home"),p.a.get("/dashboard/home",{headers:{"x-access-token":T.authHeader()}})}},{key:"userIsRegistered",value:function(){return console.log("check Login-IsRegisted user"),p.a.post("/users/get-user",{phnNumber:localStorage.getItem("phnNumber")},{headers:{"x-access-token":T.authHeader()}})}},{key:"userRegister",value:function(e,t,a){return console.log("Login-Register user"+a),p.a.post("/users/register",{username:e,email:t,phnNumber:a},{headers:{"x-access-token":T.authHeader()}})}}]),e}()),j=function(e){if(!e)return s.a.createElement("div",{className:"alert alert-danger",role:"alert"},"This field is required!")},C=function(e){if(!Object(w.isEmail)(e))return s.a.createElement("div",{className:"alert alert-danger",role:"alert"},"This is not a valid email.")},R=function(e){if(e.length<3||e.length>20)return s.a.createElement("div",{className:"alert alert-danger",role:"alert"},"The username must be between 3 and 20 characters.")},I=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).userReady=!1,n.handleRegister=n.handleRegister.bind(Object(u.a)(n)),n.onChangeUsername=n.onChangeUsername.bind(Object(u.a)(n)),n.onChangeEmail=n.onChangeEmail.bind(Object(u.a)(n)),n.state={username:"",email:"",password:"",mobile:"",successful:!1,message:""},n}return Object(i.a)(a,[{key:"onChangeUsername",value:function(e){this.setState({username:e.target.value})}},{key:"onChangeEmail",value:function(e){this.setState({email:e.target.value})}},{key:"handleRegister",value:function(e){var t=this;e.preventDefault(),this.setState({message:"",successful:!1}),this.form.validateAll(),0===this.checkBtn.context._errors.length&&y.userRegister(this.state.username,this.state.email,this.state.mobile).then((function(e){e.data.success?(t.setState({message:e.data.msg,successful:!0}),window.location.replace("http://143.110.182.130:8081/profile")):t.setState({message:e.data.msg,successful:!1})}),(function(e){403==e.response.status&&(console.log("retry with new access token"),E.isAuthenticated());var a=e.response&&e.response.data&&e.response.data.msg||e.message||e.toString();t.setState({successful:!1,message:a})}))}},{key:"componentDidMount",value:function(){var e=this;y.userIsRegistered().then((function(t){t.data.registered&&(localStorage.setItem("userInfo",t.data.toString()),window.location.replace("http://143.110.182.130:8081/profile")),e.setState({mobile:t.data.phnNumber}),e.userReady=!0,console.log("Res"+t.data.phnNumber)}),(function(e){403==e.response.status&&(console.log("retry with new access token"),E.isAuthenticated())})).catch((function(e){console.log("error"),window.location.replace("http://143.110.182.130:8081/home")}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"col-md-12"},s.a.createElement("div",{className:"card card-container"},s.a.createElement("img",{src:"//ssl.gstatic.com/accounts/ui/avatar_2x.png",alt:"profile-img",className:"profile-img-card"}),s.a.createElement(k.a,{onSubmit:this.handleRegister,ref:function(t){e.form=t}},!this.state.successful&&s.a.createElement("div",null,s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"phnNumber"},"Mobile Number:  ",this.state.mobile)),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"username"},"Name"),s.a.createElement(O.a,{type:"text",className:"form-control",name:"username",value:this.state.username,onChange:this.onChangeUsername,validations:[j,R]})),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"email"},"Email"),s.a.createElement(O.a,{type:"text",className:"form-control",name:"email",value:this.state.email,onChange:this.onChangeEmail,validations:[j,C]})),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{className:"btn btn-primary btn-block"},"Sign Up"))),this.state.message&&s.a.createElement("div",{className:"form-group"},s.a.createElement("div",{className:this.state.successful?"alert alert-success":"alert alert-danger",role:"alert"},this.state.message)),s.a.createElement(S.a,{style:{display:"none"},ref:function(t){e.checkBtn=t}}))))}}]),a}(n.Component),x=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={content:""},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.setState({content:"Home Page"})}},{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("header",{className:"jumbotron"},s.a.createElement("h3",null,this.state.content)))}}]),a}(n.Component),D=a(30),P=a.n(D),L=a(59),A=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={content:"",redirect:null,userReady:!1,currentUser:{username:""}},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(L.a)(P.a.mark((function e(){var t=this;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.getDashboardHome().then((function(e){t.setState({content:e.data,userReady:!0}),console.log("Res"+e)}),(function(e){403==e.response.status&&(console.log("retry with new access token"),E.isAuthenticated()),t.setState({content:"try again later",userReady:!1})})).catch((function(e){403==e.response.status&&(console.log("retry with new access token"),E.isAuthenticated()),t.setState({content:"try again later",userReady:!1})})),console.log("State: "+JSON.stringify(this.state));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){if(this.state.redirect)return s.a.createElement(d.a,{to:this.state.redirect});this.state.currentUser;return s.a.createElement("div",{className:"container"},this.state.userReady?s.a.createElement("div",null,s.a.createElement("header",{className:"jumbotron"},s.a.createElement("h3",null,this.state.content))):s.a.createElement("div",null,s.a.createElement("header",{className:"jumbotron"},s.a.createElement("h3",null,"Full access need to show content"))))}}]),a}(n.Component),U=a(24),H=a(16),G=a(21),B=a(3),M=a.n(B);var W=function(e){var t=e.value,a=e.handleChange,n=e.hashHandleChange;return s.a.createElement("div",{className:M.a},s.a.createElement("div",{className:M.a.background},s.a.createElement("div",{className:M.a.container},s.a.createElement("div",{className:M.a.heading},"Tigon Futuristics"),s.a.createElement("div",{className:M.a.input_text},"Phone Number:"),s.a.createElement("div",{className:M.a.input_container},s.a.createElement("input",{type:"tel",value:t.phone,onChange:a("phone"),placeholder:"Enter the Phone No.",className:M.a.input})),s.a.createElement("button",{onClick:function(a){p.a.post("/user-authenticate-service/send-otp",{phnNumber:"".concat(t.phone)}).then((function(e){console.log(e.data.otp);var t=e.data.hash;n(t)})),a.preventDefault(),e.nextStep()},className:M.a.submit},"Send OTP"))))};var F=function(e){p.a.defaults.withCredentials=!0;var t=Object(n.useState)({error:"",success:""}),a=Object(G.a)(t,2),r=a[0],o=a[1],c=e.value,l=e.handleChange;return s.a.createElement("div",{className:M.a},s.a.createElement("div",{className:M.a.background},s.a.createElement("div",{className:M.a.container},s.a.createElement("div",{className:M.a.heading},"Tigon Futuristics"),s.a.createElement("div",{className:M.a.error},r.error),s.a.createElement("div",{className:M.a.success},r.success),s.a.createElement("div",{className:M.a.input_text},"Enter One Time Password:"),s.a.createElement("div",{className:M.a.input_container},s.a.createElement("input",{type:"tel",value:c.otp,onChange:l("otp"),placeholder:"Enter the 6 digits OTP",className:M.a.input})),s.a.createElement("button",{onClick:function(t){t.preventDefault(),e.prevStep()},className:M.a.back},"Back"),s.a.createElement("button",{onClick:function(){localStorage.setItem("phnNumber","".concat(c.phone)),p.a.post("/user-authenticate-service/verify-otp",{phnNumber:"".concat(c.phone),hash:"".concat(c.hash),otp:"".concat(c.otp),withCredentials:!0}).then((function(e){console.log(e.data),e.data.varification&&(console.log("dd"),localStorage.setItem("accessToken",e.data.accessToken),localStorage.setItem("accessTokenExp",e.data.accessTokenExp),localStorage.setItem("refreshToken",e.data.refreshToken),localStorage.setItem("refreshTokenExp",e.data.refreshTokenExp),window.location.replace("http://143.110.182.130:8081/register"))})).catch((function(e){console.log(e.response.data),o(Object(H.a)(Object(H.a)({},e),{},{error:e.response.data.msg}))}))},className:M.a.submit},"Verify OTP"))))},J=function(){var e=Object(n.useState)({phone:"",hash:"",otp:""}),t=Object(G.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(1),c=Object(G.a)(o,2),l=c[0],i=c[1],u=function(e){return function(t){r(Object(H.a)(Object(H.a)({},a),{},Object(U.a)({},e,t.target.value)))}},m=function(){i((function(e){return e+1}))},h={phone:a.phone,hash:a.hash,otp:a.otp};switch(l){case 1:return s.a.createElement(W,{nextStep:m,hashHandleChange:function(e){r(Object(H.a)(Object(H.a)({},a),{},{hash:e}))},handleChange:u,value:h});case 2:return s.a.createElement(F,{nextStep:m,prevStep:function(){i((function(e){return e-1}))},handleChange:u,value:h});default:return s.a.createElement(W,{nextStep:m,handleChange:u,value:h})}},K=function(e){Object(m.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).logOut=n.logOut.bind(Object(u.a)(n)),n.state={showModeratorBoard:!1,showAdminBoard:!1,currentUser:void 0},n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=E.getCurrentUser();e&&this.setState({currentUser:e,showModeratorBoard:"",showAdminBoard:""})}},{key:"logOut",value:function(){E.logout()}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("nav",{className:"navbar navbar-expand navbar-dark bg-dark"},s.a.createElement("div",{className:"navbar-nav mr-auto"},s.a.createElement("li",{className:"nav-item"},s.a.createElement(c.b,{to:"/home",className:"nav-link"},"Home"))),"http://143.110.182.130:8081/profile"==window.location?s.a.createElement("div",{className:"navbar-nav ml-auto"},s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{href:"/home",className:"nav-link",onClick:this.logOut},"LogOut"))):s.a.createElement("div",{className:"navbar-nav ml-auto"},s.a.createElement("li",{className:"nav-item"},s.a.createElement(c.b,{to:"/login",className:"nav-link"},"Login")))),s.a.createElement("div",{className:"container mt-3"},s.a.createElement(d.d,null,s.a.createElement(d.b,{exact:!0,path:["/","/home"],component:x}),s.a.createElement(d.b,{exact:!0,path:"/login",component:J}),s.a.createElement(d.b,{exact:!0,path:"/register",component:I}),s.a.createElement(d.b,{exact:!0,path:"/profile",component:A}))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(c.a,null,s.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},3:function(e,t,a){e.exports={background:"style_background__3JRx4",container:"style_container__16WhY",heading:"style_heading__tHRGs",input_container:"style_input_container__3Oswj",input_text:"style_input_text__3Wecr",input:"style_input__1hbW0",submit:"style_submit__3oYF1",back:"style_back__1Db_Z",error:"style_error__2dPhQ",success:"style_success__iab9R"}},63:function(e,t,a){e.exports=a(159)},69:function(e,t,a){}},[[63,1,2]]]);
//# sourceMappingURL=main.7ba18252.chunk.js.map